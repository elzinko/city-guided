name: development
version: "1.0.0"
description: Development workflow rules for rapid feedback and quality
tags: [development, workflow, feedback-loop]

rules:
  - id: local-first-feedback
    title: Local-First Feedback Loop
    level: MUST
    content: |
      - Reproduce and validate changes LOCALLY before triggering CI pipelines
      - Use targeted verification (focused tests) closest to the change before running full suite
      - DO NOT spam CI reruns without significant changes or locally tested hypothesis
      - Run smoke tests locally (start services + verify healthchecks) before push

  - id: handle-blockers
    title: Stop and Inform on Blockers
    level: MUST
    content: |
      When a problem persists and cannot be fixed properly:
      - MUST suspend modifications and inform the user with:
        - What is blocking (symptom)
        - What has been tried
        - What remains uncertain
      - MUST explicitly propose next steps:
        - Continue (with timebox), OR
        - Alternative/workaround (to ship/progress), OR
        - Scope reduction
      - SHOULD timebox investigations before expanding scope

  - id: workaround-traceability
    title: Document Workarounds and Decisions
    level: MUST
    content: |
      - DO NOT introduce silent workarounds without explanation
      - When a workaround or non-obvious decision is needed, MUST add an English comment near the code explaining:
        - Context (why this exists)
        - Trade-off (what we accept / what we lose)
        - Alternatives considered (at least 1)
        - Why this choice is acceptable for now
      - SHOULD create a document in choices/ describing the decision and link it from the comment
      
      Example comment format:
      ```
      // WORKAROUND: <short summary>
      // Context: <why this exists>
      // Trade-off: <what we accept / what we lose>
      // Alternatives: <option A>, <option B>
      // Decision record: choices/0001-short-title.md
      ```

  - id: test-philosophy
    title: Testing Philosophy
    level: MUST
    content: |
      - Fix bugs with a test that captures them (when realistic and stable)
      - Maintain clear separation:
        - Unit tests (fast) for domain
        - Integration tests for adapters
        - E2E for critical paths
      - DO NOT disable tests to "go faster" without reactivation plan
      - SHOULD maintain a smoke test "it starts" (even minimal) to avoid CI round-trips

  - id: use-project-scripts
    title: Use Project Scripts as Source of Truth
    level: MUST
    content: |
      - MUST prioritize and maximize use of npm/pnpm scripts defined in package.json files:
        - Root project package.json
        - Sub-folders (apps, services, packages) if specific scripts are defined
      - DO NOT execute underlying commands directly (turbo, eslint, docker compose) if equivalent npm/pnpm script exists
      - If operational scripts exist (infra/docker/scripts/*):
        - MUST be the standard interface used by npm/pnpm scripts
        - SHOULD manage lifecycle by environment (local|ci|staging|prod)
        - SHOULD centralize setup/start/stop/logs/wait/deploy

  - id: quality-guardrails
    title: Quality and Consistency Guardrails
    level: MUST
    content: |
      - Apply lint/format/type-check before push when repo uses them
      - SHOULD make small and reversible changes (focused PRs/commits)
      - DO NOT mix massive refactor + behavioral fix without necessity (hard to review/debug)

  - id: playwright-mcp-usage
    title: Playwright MCP Usage
    level: MUST
    content: |
      - Use Playwright MCP ONLY if necessary (high token cost)
      - MUST request user approval before using Playwright MCP
      - MUST use it minimally (as light as possible), unless really necessary and approved by user
