# Docker Compose - Build Override
# Use this file to build images locally instead of pulling from GHCR
#
# Usage:
#   docker compose -f docker-compose.yml -f docker-compose.build.yml --env-file .env.local build
#   docker compose -f docker-compose.yml -f docker-compose.build.yml --env-file .env.local up -d
#
# Or use the convenience script:
#   ./scripts/build.sh local

services:
  api:
    build:
      context: ../../..
      dockerfile: infra/deployment/compose/Dockerfile.api
    image: city-guided-api:local

  web:
    build:
      context: ../../..
      dockerfile: infra/deployment/compose/Dockerfile.frontend
      args:
        NEXT_PUBLIC_API_URL: ${NEXT_PUBLIC_API_URL:-}
        NEXT_PUBLIC_OSRM_URL: ${NEXT_PUBLIC_OSRM_URL:-}
        NEXT_PUBLIC_SHOW_DEV_OPTIONS: ${NEXT_PUBLIC_SHOW_DEV_OPTIONS:-true}
        DOCKER_ENV: "true"
        API_PORT: ${API_PORT:-4000}
    image: city-guided-web:local

